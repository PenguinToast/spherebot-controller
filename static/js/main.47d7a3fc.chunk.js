(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{33:function(e,t,n){e.exports=n(52)},38:function(e,t,n){},42:function(e,t,n){},44:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),i=n(19),o=n.n(i),s=(n(38),n(8)),u=n.n(s),l=n(10),h=n(12),d=n(13),f=n(15),v=n(14),m=n(16),p=(n(42),n(57)),g=n(7),b=n(56),w=n(48),k=n(55),y=n(50),C=n(6),E=n(51),R=n(49),x=n(17),j=(n(44),n(22)),O=n.n(j),S=n(54),T=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,c=new Array(a),i=0;i<a;i++)c[i]=arguments[i];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(c)))).divRef=Object(r.createRef)(),n.canvasRef=Object(r.createRef)(),n.currentTouch=null,n.redraw=function(){var e=n.canvasRef.current;if(e){var t=e.getContext("2d"),a=e.width,r=e.height;t.clearRect(0,0,a,r),n.drawBackground(t,a,r);var c=n.valueToY(e,n.props.value);t.fillStyle="#3DCC91",t.fillRect(1,r/2,a-2,c-r/2),t.beginPath(),t.arc(a/2,c,n.radius(e),0,2*Math.PI),t.closePath(),t.fillStyle="#394B59",t.fill(),t.stroke()}},n.handlePress=function(e,t){var a=n.canvasRef.current;if(a){var r=n.windowToCanvas(a,e,t);n.props.onChange(n.yToValue(a,r.y))}},n.handleResize=function(){var e=n.canvasRef.current,t=n.divRef.current;e&&t&&(n.sizeCanvas(e,t),setTimeout(n.redraw,1))},n.handleMouseEvent=function(e){n.handlePress(e.clientX,e.clientY)},n.handleTouchStart=function(e){var t=e.changedTouches.item(0);t&&(n.currentTouch=t.identifier,n.handlePress(t.clientX,t.clientY))},n.handleTouchMove=function(e){var t=!0,a=!1,r=void 0;try{for(var c,i=e.changedTouches[Symbol.iterator]();!(t=(c=i.next()).done);t=!0){var o=c.value;if(o.identifier===n.currentTouch)return void n.handlePress(o.clientX,o.clientY)}}catch(s){a=!0,r=s}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}},n.handleTouchEnd=function(e){var t=!0,a=!1,r=void 0;try{for(var c,i=e.changedTouches[Symbol.iterator]();!(t=(c=i.next()).done);t=!0){if(c.value.identifier===n.currentTouch)return void(n.currentTouch=null)}}catch(o){a=!0,r=o}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}},n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"roundRect",value:function(e,t,n,a,r,c){return a<2*c&&(c=a/2),r<2*c&&(c=r/2),e.beginPath(),e.moveTo(t+c,n),e.arcTo(t+a,n,t+a,n+r,c),e.arcTo(t+a,n+r,t,n+r,c),e.arcTo(t,n+r,t,n,c),e.arcTo(t,n,t+a,n,c),e.closePath(),e}},{key:"drawBackground",value:function(e,t,n){e.fillStyle="#BFCCD6",this.roundRect(e,0,0,t,n,t/2).fill(),this.roundRect(e,0,0,t,n,t/2).stroke()}},{key:"sizeCanvas",value:function(e,t){e.width=t.clientWidth,e.height=t.clientHeight}},{key:"radius",value:function(e){return e.width/2-1}},{key:"valueToY",value:function(e,t){var n=e.height;return n/2+-t*(n/2-this.radius(e))}},{key:"yToValue",value:function(e,t){var n=e.height,a=(n/2-t)/(n/2-this.radius(e));return a>1?1:a<-1?-1:a}},{key:"windowToCanvas",value:function(e,t,n){var a=e.getBoundingClientRect();return{x:t-a.left*(e.width/a.width),y:n-a.top*(e.height/a.height)}}},{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current;t&&(t.addEventListener("mousedown",function(t){e.handleMouseEvent(t),window.addEventListener("mousemove",e.handleMouseEvent),window.addEventListener("mouseup",function(){window.removeEventListener("mousemove",e.handleMouseEvent),window.removeEventListener("mouseup",e.handleMouseEvent)})}),t.addEventListener("touchstart",this.handleTouchStart),t.addEventListener("touchmove",this.handleTouchMove),t.addEventListener("touchend",this.handleTouchEnd),this.handleResize())}},{key:"componentDidUpdate",value:function(){this.redraw()}},{key:"render",value:function(){return c.a.createElement(S.a,{onResize:this.handleResize},c.a.createElement("div",{className:this.props.className,ref:this.divRef},c.a.createElement("canvas",{ref:this.canvasRef})))}}]),t}(r.Component);!function(e){e[e.Left=1]="Left",e[e.Right=0]="Right"}(a||(a={}));var D,L=function(e){function t(){var e,n,c,i;Object(h.a)(this,t);for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];return(i=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(s)))).state=(n={},Object(x.a)(n,a.Left,0),Object(x.a)(n,a.Right,0),n),i.divRef=Object(r.createRef)(),i.lastSeqNo=0,i.lastAck=0,i.motorHandlers=(c={},Object(x.a)(c,a.Left,i.getMotorHandler(a.Left)),Object(x.a)(c,a.Right,i.getMotorHandler(a.Right)),c),i.handleAck=Object(l.a)(u.a.mark(function e(){var t;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.props.characteristic.value){e.next=3;break}return e.abrupt("return");case 3:i.lastAck=t.getUint32(0,!0);case 4:case"end":return e.stop()}},e,this)})),i.handleCenterClick=function(){O.a&&O.a.enabled&&i.divRef.current&&O.a.toggle(i.divRef.current)},i}return Object(m.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.characteristic.startNotifications();case 2:return this.props.characteristic.addEventListener("characteristicvaluechanged",this.handleAck),e.next=5,this.props.characteristic.writeValue(Uint8Array.from([255,255,255,255,255,255,255,255,255]));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(l.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.characteristic.removeEventListener("characteristicvaluechanged",this.handleAck),e.next=3,this.props.characteristic.writeValue(Uint8Array.from([238,238,238,238,238,238,238,238,238]));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getMotorHandler",value:function(e){var t=this;return function(){var n=Object(l.a)(u.a.mark(function n(a){var r,c,i,o;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(t.setState(Object(x.a)({},e,a)),r=t.lastSeqNo,c=r>=4294967295?0:r+1,i=new ArrayBuffer(9),(o=new DataView(i)).setInt32(0,c,!0),o.setInt8(4,e),o.setFloat32(5,a,!0),t.lastAck==r){n.next=10;break}return n.abrupt("return");case 10:return t.lastSeqNo=c,n.next=13,t.props.characteristic.writeValue(i);case 13:case"end":return n.stop()}},n,this)}));return function(e){return n.apply(this,arguments)}}()}},{key:"render",value:function(){return c.a.createElement("div",{className:"controller",ref:this.divRef},c.a.createElement("div",{className:"slider-container"},c.a.createElement(T,{className:"slider",value:this.state[a.Left],onChange:this.motorHandlers[a.Left]})),c.a.createElement("div",{className:"center-icon-container"},c.a.createElement(p.a,{className:"center-icon",icon:"horizontal-distribution",large:!0,onClick:this.handleCenterClick})),c.a.createElement("div",{className:"slider-container"},c.a.createElement(T,{className:"slider",value:this.state[a.Right],onChange:this.motorHandlers[a.Right]})))}}]),t}(r.Component);!function(e){e[e.Connected=0]="Connected",e[e.Connecting=1]="Connecting",e[e.Disconnected=2]="Disconnected",e[e.Disconnecting=3]="Disconnecting"}(D||(D={}));var N="0000ffe0-0000-1000-8000-00805f9b34fb",A="0000ffe1-0000-1000-8000-00805f9b34fb",M=function(e){function t(){var e,n;Object(h.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(f.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).state={connectionState:D.Disconnected,characteristic:null},n.handleConnectClick=Object(l.a)(u.a.mark(function e(){var t,a,r,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.setState({connectionState:D.Connecting}),e.next=4,navigator.bluetooth.requestDevice({filters:[{name:"Spherebot",services:[N]}]});case 4:if((t=e.sent).gatt){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,t.gatt.connect();case 9:return a=e.sent,e.next=12,a.getPrimaryService(N);case 12:return r=e.sent,e.next=15,r.getCharacteristic(A);case 15:c=e.sent,n.setState({connectionState:D.Connected,characteristic:c}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.log("Error: ",e.t0),n.setState({connectionState:D.Disconnected,characteristic:null});case 23:case"end":return e.stop()}},e,this,[[0,19]])})),n.handleDisconnectClick=Object(l.a)(u.a.mark(function e(){var t,a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n.setState({connectionState:D.Disconnecting}),t=n.state.characteristic){e.next=5;break}return e.abrupt("return");case 5:if(a=t.service){e.next=8;break}return e.abrupt("return");case 8:if(r=a.device.gatt){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,r.disconnect();case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.log("Error: ",e.t0);case 18:n.setState({connectionState:D.Disconnected,characteristic:null});case 19:case"end":return e.stop()}},e,this,[[0,15]])})),n}return Object(m.a)(t,e),Object(d.a)(t,[{key:"renderConnectionButton",value:function(){switch(this.state.connectionState){case D.Disconnected:return c.a.createElement(p.a,{text:"Connect",intent:g.a.PRIMARY,onClick:this.handleConnectClick});case D.Connected:return c.a.createElement(p.a,{text:"Disconnect",intent:g.a.WARNING,onClick:this.handleDisconnectClick});case D.Disconnecting:return c.a.createElement(p.a,{text:"Disconnecting",disabled:!0});case D.Connecting:return c.a.createElement(p.a,{text:"Connecting",disabled:!0})}}},{key:"renderController",value:function(){var e=this.state.characteristic;return e?c.a.createElement(L,{characteristic:e}):c.a.createElement(b.a,{icon:"offline",title:"Disconnected from Spherebot!"})}},{key:"renderBody",value:function(){switch(this.state.connectionState){case D.Disconnected:return c.a.createElement(b.a,{icon:"offline",title:"Please connect to Spherebot"});case D.Connecting|D.Disconnecting:return c.a.createElement(b.a,{className:"main-spinner",icon:c.a.createElement(w.a,null),title:"Loading..."});case D.Connected:return this.renderController()}}},{key:"render",value:function(){return c.a.createElement("div",{className:"main"},c.a.createElement(k.a,null,c.a.createElement(y.a,{align:C.a.LEFT},c.a.createElement(E.a,null,"Spherebot"),c.a.createElement(R.a,null),this.renderConnectionButton())),this.renderBody())}}]),t}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(c.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,2,1]]]);
//# sourceMappingURL=main.47d7a3fc.chunk.js.map